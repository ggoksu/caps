#!/usr/bin/env bash

set -exu

if [[ -e /var/vcap/jobs/harbor/config ]]; then

  cd /var/vcap/jobs/harbor/config
  cert_diff=$(diff -u ./ca.crt ./uaa_ca.crt)

  if [[ -n "$cert_diff" ]]; then
    cp ./ca.crt ./uaa_ca.crt

    cd /var/vcap/jobs/harbor/bin
    monit stop harbor
    ./pre-start
    monit start harbor
  fi
fi
